trigger:
  branches:
    include:
      - dev
  paths:
    include:
      - frontend/admin-dashboard/**

pool:
  name: ubuntu-22.04

variables:
  frontendDir: "$(Build.SourcesDirectory)/frontend/admin-dashboard"
  artifactName: "admin-dashboard"

steps:
  - checkout: self

  - task: NodeTool@0
    inputs:
      versionSpec: "22.x"
    displayName: "Use Node 22"

  # create  on the agent from pipeline variables (set these in pipeline variables/library)
  - script: |
      cat >  <<'EOF'
      VITE_API_BASE_URL=${VITE_API_BASE_URL}
      VITE_API_TIMEOUT=${VITE_API_TIMEOUT}
      VITE_AUTH_TOKEN_KEY=${VITE_AUTH_TOKEN_KEY}
      # add other VITE_* vars as needed
      EOF
    workingDirectory: $(frontendDir)
    displayName: "Create .env.staging"
    env:
      VITE_API_BASE_URL: $(VITE_API_BASE_URL)
      VITE_API_TIMEOUT: $(VITE_API_TIMEOUT)
      VITE_AUTH_TOKEN_KEY: $(VITE_AUTH_TOKEN_KEY)

  - script: npm ci
    workingDirectory: $(frontendDir)
    displayName: "Install NPM dependencies"

  - script: npm run build:staging
    workingDirectory: $(frontendDir)
    displayName: "Build React app (staging)"

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: "$(frontendDir)/dist"
      ArtifactName: $(artifactName)
      publishLocation: "Container"
    displayName: "Publish Build Artifacts"
